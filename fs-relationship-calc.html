<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="./rc-wrap.html">
<link rel="import" href="./rc-column.html">
<link rel="import" href="./rc-person.html">
<link rel="import" href="../layout/layout.html">
<link rel="import" href="../I18NBehavior/I18NBehavior.html">

<dom-module id='fs-relationship-calc'>
  <link rel="import" type="css" href="./relationshipCalc.css">
  <template>
    <div class="backdrop layout horizontal fullbleed fixed center center-justified" on-click="toggleShowHide">
      <div class="outer" on-click="_preventDefault">
        <div class="header clearfix">
          <strong>
            <p>[[i18n.relationship]]</p>
          </strong>
          <a class="close" href="javascript:;" on-click="toggleShowHide">Ã—</a>
        </div>
        <template is="dom-if" if="{{_error}}">
          <div class="alert alert-danger">
            <span>[[i18n.error_retrieving_relationship]]</span>
          </div>
        </template>
        <div id="container" class="wrap">
            <template is="dom-if" if="{{personId}}">
              <iron-ajax 
                auto
                url="{{_soiURL(personId)}}" 
                method="GET"
                headers='{{_headers}}'
                on-response="_parseRelationships"
                on-error="_handleError"></iron-ajax>
                <template is="dom-if" if="{{!_dataLoaded}}">
                  <img src="data:image/gif;base64,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">
                </template>
            </template>
          <rc-wrap id="wrap"></rc-wrap>
        </div>
        <div class="footer">
          <button on-click="toggleShowHide">[[i18n.close]]</button>
        </div>
      </div>
    </div>
  </template>
</dom-module>
<script>
  var Person = function(json, i18n) {
    this.id = json.personId;
    this.name = (json.name) ? json.name : i18n.living;
    this.top = (json.top !== undefined) ? json.top : false;
    this.gender = json.gender;
    this.relationshipToPrevious = json.relationshipToPrevious === 'SELF' ? 'me' : json.relationshipToPrevious.toLowerCase();
    this.relationshipTitle = (i18n[this.relationshipToPrevious]) ? i18n[this.relationshipToPrevious].toUpperCase() : this.relationshipToPrevious.toUpperCase();
    this.last = (json.last !== undefined) ? json.last : false;
    this.living = (json.name === '');
    // console.log(this.relationshipTitle);
  };

  function broadRelType(rel) {
    if (!rel) return 'other';
    rel = rel.toLowerCase();
    switch (rel) {
      case 'son':
      case 'daughter':
      case 'child':
        return 'child';
      case 'mother':
      case 'father':
      case 'parent':
        return 'parent';
      case 'husband':
      case 'wife':
      case 'spouse':
        return 'spouse';
    }
    return 'other';
  }

  Polymer({
    null: null,
    is: 'fs-relationship-calc',
    behaviors: [ componenti18n('fs-relationship-calc') ],
    properties: {
      personId: {
        type: String,
        value: null,
        observer: '_clear'
      },
      _headers: {
        type: Object,
        value: {
          Authorization: 'Bearer ' + FS.Cookie.getCookie('fssessionid'),
          Accept: 'application/json'
        }
      },
      _currentColumn: {
        type: Number,
        value:0,
        observer: '_setWidth'
      },
    },
    _clear: function() {
      var _this = this;
      _this._error = null;
      _this._dataLoaded = false;
      var existing = [].slice.call(Polymer.dom(_this.$.wrap).childNodes);
      existing.forEach(function(el) {
        Polymer.dom(_this.$.wrap).removeChild(el);
      });
    },
    ready: function() {
      var _this = this;
      document.addEventListener('show-relationship-calc', function(event) {
        if (!event.detail.personId) {
          return console.warn('Relationship Calculator: Invalid configuration');
        }
        _this.toggleClass('hide', false);
        this._clear();
      });
    },
    toggleShowHide: function() {
      this.classList.toggle('hide');
    },
    _preventDefault: function(event) {
      return event.stopPropagation();
    },
    _setWidth: function() {
      this.toggleClass('two-column', false, this.$.container);
      this.toggleClass('three-column', false, this.$.container);

      switch(this._currentColumn) {
        case 2:
          return this.toggleClass('two-column', true, this.$.container);
        case 3:
          return this.toggleClass('three-column', true, this.$.container);
      }
    },
    _soiURL: function(id) {
      return '/scopeservice/soi/related/' + this.personId;
    },
    _handleError: function() {
      this._dataLoaded = true;
      this._error = true;
    },
    _parseRelationships: function(event, request) {
      var _this = this;
      this._dataLoaded = true;
      var data = request.response;
      data.relationship[data.relationship.length - 1].last = true;
      var topIndex = 0;
      this._currentColumn = 0;
      this._buildRelationshipCalc(data.relationship.map(function(soiPerson, index) {
        var person = new Person(soiPerson, _this.i18n || {});
        if (person.top) topIndex = index;
        return person;
      }), topIndex);
    },
    _addColumn: function() {
      var column = document.createElement('rc-column');
      column.number = this._currentColumn + 1;
      Polymer.dom(this.$.wrap).appendChild(column);
      this._currentColumn++;
      return column;
    },
    _createNode: function(person, column) {
      // console.log('Creating Person:', person);
      var element = document.createElement('rc-person');
      element.person = person;
      if (column) {
        var node = Polymer.dom(column)
        node.insertBefore(element, node.firstChild);
      }
      return element;
    },
    _addBlankNodes: function(count, column) {
      for (var i = 0; i < count; i++) {
        var el = document.createElement('nc-person');
        el.isBlank = true;
        Polymer.dom(column).appendChild(el);
      }
    },
    _buildRelationshipCalc: function(persons, topIndex) {
      var columns = [];
      columns.push(this._addColumn());
      var topShouldBeInColumn = true;
      if (typeof persons[topIndex+1] !== 'undefined') {
        if (broadRelType(persons[topIndex + 1].relationshipToPrevious) === 'child') {
          topShouldBeInColumn = false;
        }
      }
      
      var blankCount = 0;
      for (var i = 0, limit = persons.length; i < limit; i++) {
        if (i === topIndex) continue;
        
        if (i === topIndex + 1) { 
          // add the second column
          columns.push(this._addColumn());
        } else if (i > topIndex) {
          if (broadRelType(persons[i].relationshipToPrevious.toLowerCase()) === 'spouse') {
            columns.push(this._addColumn());
            this._addBlankNodes(blankCount, columns[columns.length-1]);
          } else {
            blankCount++;
          }
        }

        var node = this._createNode(persons[i]);
        if (i < topIndex) {
          Polymer.dom(columns[this._currentColumn - 1]).insertBefore(node, Polymer.dom(columns[this._currentColumn - 1]).firstChild);
        } else {
          Polymer.dom(columns[this._currentColumn - 1]).appendChild(node);
        }
      }
      if (topShouldBeInColumn) {
        // if top person is supposed to be in the first column, then put it there
        this._createNode(persons[topIndex], columns[0]);
      } else {
        // otherwise prepend top person node to wrapper element (outside columns)
        Polymer.dom(this.$.wrap).insertBefore(this._createNode(persons[topIndex]), Polymer.dom(this.$.wrap).firstChild);
      }
    }
  });
</script>